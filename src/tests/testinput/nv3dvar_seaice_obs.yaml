cost function:
  cost type: 3D-Var
#  cost type: 3D-FGAT
  time window:
    begin: 2021-06-29T00:00:00Z
    length: P1D
  forecast length: P0D
#  model:
#    name: orcamodel
#    tstep: P6H
  analysis variables: [ice_area_fraction]
  background error:
    covariance model: ORCAstatic
    mode: 2
    covtype: Shapiro
#  covtype: Nemovar
    date: 2021-06-29T00:00:00Z
  geometry :
    nemo variables:
      - name: ice_area_fraction
        nemo field name: iiceconc
        model space: surface
      - name: sea_surface_temperature
        nemo field name: votemper
        model space: surface
      - name: sea_water_potential_temperature
        nemo field name: votemper
        model space: volume
      - name: ice_area_fraction_background_error
        nemo field name: sic_tot_var
        model space: surface
        variable type: background variance
    grid name: ORCA2_T
#    number levels: 10
    number levels: 2
  background :
    date: 2021-06-29T12:00:00Z
    state variables: [ ice_area_fraction ]
    nemo field file: Data/orca2_t_nemo.nc
#    variance field file: Data/orca2_t_bkg_var.nc
    mask field file: Data/orca2_mask.nc
  observations:
    observers:
    - obs space:
        name: Sea Ice
        obsdatain:
          engine:
            type: H5File
#            obsfile: Data/ostia_seaice_obs_multi.nc
            obsfile: Data/ostia_seaice_obs_ideal.nc
        obsdataout:
          engine:
            type: H5File
            obsfile: testoutput/test_ostia_3dvar.nc
        simulated variables: [ice_area_fraction]
      get values:
        time interpolation: linear
        atlas-interpolator:
          type: unstructured-bilinear-lonlat
          non_linear: missing-if-all-missing
          max_fraction_elems_to_try: 0.0
          adjoint: true
      obs operator:
        name: Composite
        components:
        - name: Identity
          observation alias file: testinput/test_name_map.yaml
#        - name: BackgroundErrorIdentity
#          observation alias file: testinput/test_name_map.yaml
      obs error:
        covariance model: diagonal
#      obs filters:        
#      - filter: Variable Assignment
#        assignments:
#        - name: ice_area_fraction@GrossErrorProbability
#          type: float
#          value: 0.04
#      - filter: Create Diagnostic Flags
#        flags:
#        - name: FinalReject
#          initial value: false
#        - name: ObNotDefinedReject
#          initial value: false
#        - name: BgNotDefinedReject
#          initial value: false
#        - name: ObOutOfBoundsReject
#          initial value: false
#        - name: BgOutOfBoundsReject
#          initial value: false
#        - name: BayBgCheckReject
#          initial value: false
#      - filter: Perform Action
#        filter variables:
#        - name: ice_area_fraction
#        action:
#          name: assign error
#          error parameter: 0.3162277
#      - filter: Bounds Check
#        defer to post: true
#        filter variables:
#        - name: ice_area_fraction
#        minvalue: 0.0
#        maxvalue: 1.0
#        actions:
#        - name: set
#          flag: FinalReject
#        - name: set
#          flag: ObOutOfBoundsReject
#        - name: reject
#      - filter: Bounds Check
#        defer to post: false
#        filter variables:
#        - name: ice_area_fraction@HofX
#        minvalue: -1.0
#        maxvalue: 1.0
#        actions:
#        - name: set
#          flag: FinalReject
#        - name: set
#          flag: BgOutOfBoundsReject
#        - name: reject        
variational:
  minimizer:
    algorithm: DRIPCG
  iterations:
  - ninner: 1
    gradient norm reduction: 1e-30
    geometry :
      nemo variables:
        - name: ice_area_fraction
          nemo field name: iiceconc
          model space: surface
        - name: sea_surface_temperature
          nemo field name: votemper
          model space: surface
        - name: sea_water_potential_temperature
          nemo field name: votemper
          model space: volume
        - name: ice_area_fraction_background_error
          nemo field name: sic_tot_var
          model space: surface
          variable type: background variance
      grid name: ORCA2_T
      number levels: 10
      use nemovar: true
    linear model:
#      # 3dfgat utilizes the generic identity linear model, implemented in oops::IdentityLinearModel
      name: Identity
      increment variables: [ice_area_fraction]
      variable change: Identity
      tstep: PT6H
    test: on
    online diagnostics:
      write increment: true
      increment:
        state component:
          datadir: Data
          filepath: testoutput/nvincrements_seaice
          date: 2021-06-29T00:00:00Z
          exp: 3dvar.iter1
          type: in
final:
  diagnostics:
    departures: oman
output:
#  datadir: Data
#  filepath: testoutput/nv3dvar_seaice_%id%
  times: ["2021-06-29T00:00:00Z"]
  state variables: [ ice_area_fraction ]
  nemo field file: testoutput/nv3dvar_seaice
#  exp: 3dvar
#  steps: ["2021-06-29T12:00:00Z"]               # state write not implemented 
#  steps: ["2010-01-02T00:00:00Z"]
#  frequency: PT6H
#  type: an
#  increment:
#    state component:
#      datadir: Data
#      filepath: testoutput/nvincrements_final_seaice
#      date: 2021-06-29T00:00:00Z
#      exp: 3dvar.iter1
#      type: in


time window:
  begin: '2021-06-29T00:00:00Z'
  length: P1D
date: '2021-06-29T12:00:00Z'

#test:
#  reference filename: testoutput/test_ostia_seaice_obs_hofx3d.ref
